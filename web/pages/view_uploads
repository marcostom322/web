<?php
$page_title = "Archivos";
require '../includes/auth.php';
redirectIfNotLoggedIn();

$uploads_dir = '../uploads/';
$files = array_diff(scandir($uploads_dir), array('.', '..'));
?>

<!DOCTYPE html>
<html>
<head>
    <title><?php echo $page_title; ?></title>
    <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>
    <?php include '../includes/header.php'; ?>
    <main>
        <h1>Archivos Subidos</h1>
        <div class="uploads">
            <?php foreach ($files as $file): ?>
                <div class="upload-item">
                    <?php $file_path = "../serve_file.php?file=" . urlencode($file); ?>
                    <?php if (strpos(mime_content_type($uploads_dir . $file), 'image') !== false): ?>
                        <img src="<?php echo $file_path; ?>" alt="<?php echo htmlspecialchars($file, ENT_QUOTES, 'UTF-8'); ?>" style="width: 100px; height: 100px;">
                    <?php else: ?>
                        <a href="<?php echo $file_path; ?>" target="_blank"><?php echo htmlspecialchars($file, ENT_QUOTES, 'UTF-8'); ?></a>
                    <?php endif; ?>
                </div>
            <?php endforeach; ?>
        </div>
    </main>
    <?php include '../includes/footer.php'; ?>
</body>
</html>
